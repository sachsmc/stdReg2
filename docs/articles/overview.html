<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="stdReg2">
<title>Estimation of causal effects using stdReg2 • stdReg2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimation of causal effects using stdReg2">
<meta property="og:description" content="stdReg2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stdReg2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/overview.html">Estimation of causal effects using stdReg2</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimation of causal effects using stdReg2</h1>
            
      
      
      <div class="d-none name"><code>overview.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">stdReg2</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="introduction-and-context">Introduction and context<a class="anchor" aria-label="anchor" href="#introduction-and-context"></a>
</h3>
<p>Suppose <span class="math inline">\(X\)</span> denotes an exposure of
interest that takes values 0 or 1. This could represent two different
medical treatments, environmental exposures, economic policies, or
genetic variants. We will most often use biomedical examples because we
are biostatisticians.</p>
<p>We consider the setting where it is of interest to quantify the
effect of intervening with <span class="math inline">\(X\)</span> on
outcome that we will denote <span class="math inline">\(Y\)</span>. The
outcome could represent some numeric value, it could be the presence or
absence of a condition, or it could be the time between two events, such
as time from cancer diagnosis to death. Let <span class="math inline">\(Y(X = x)\)</span> denote the potential outcome if
all subjects in the population would hypothetically be exposed to <span class="math inline">\(X = x\)</span>.</p>
<p>To quantify the effect of <span class="math inline">\(X\)</span>, we
must summarize the distribution of <span class="math inline">\(Y(X =
x)\)</span> with some statistic. If <span class="math inline">\(Y\)</span> is dichotomous, it is natural to use
<span class="math inline">\(p\{Y(X = x) = 1\}\)</span>, called the risk.
If <span class="math inline">\(Y\)</span> is continuous, the mean is a
natural summary statistic <span class="math inline">\(E\{Y(X =
x)\}\)</span>. If <span class="math inline">\(Y\)</span> is a continuous
time-to-event, the probability of exceeding a particular value <span class="math inline">\(t\)</span> is a reasonable statistic: <span class="math inline">\(p\{Y(X = x) &gt; t\}\)</span>. In general, denote
the summary statistic of choice as <span class="math inline">\(T\{Y(X =
x)\}\)</span>. The summary statistic can also be applied to conditional
distributions, which we will denote, e.g., <span class="math inline">\(T\{Y | X = x\}\)</span>.</p>
<p>To quantify the effect of <span class="math inline">\(X\)</span>, we
must also decide on a <em>contrast</em> to measure the causal effect.
The point of the contrast is to compare the chosen summary statistic
between the <span class="math inline">\(X = 1\)</span> and <span class="math inline">\(X = 1\)</span>. Typical choices would be the
difference <span class="math inline">\(T\{Y(X = 1)\} - T\{Y(X =
0)\}\)</span> or the ratio <span class="math inline">\(T\{Y(X = 1)\} /
T\{Y(X = 0)\}\)</span>. It may also be of interest to quantify and
report the summary statistics within each group <span class="math inline">\((T\{Y(X = 1)\}, T\{Y(X = 0)\})\)</span>.</p>
<p>In observational studies, the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is likely confounded by a set of other
variables <span class="math inline">\(\boldsymbol{Z}\)</span>. This
means that the values of the outcome <span class="math inline">\(Y\)</span> are determined by at least a subset of
<span class="math inline">\(\boldsymbol{Z}\)</span> and the values of
the exposure <span class="math inline">\(X\)</span> are determined by a
subset of <span class="math inline">\(\boldsymbol{Z}\)</span>. Naively
estimating the contrast would lead to biased estimates of the causal
effect.</p>
</div>
<div class="section level3">
<h3 id="regression-standardization">Regression standardization<a class="anchor" aria-label="anchor" href="#regression-standardization"></a>
</h3>
<p>See <span class="citation">Sjölander (2016)</span> and <span class="citation">Sjölander (2018)</span> for more details. Suppose that
the covariates <span class="math inline">\(\boldsymbol{Z}\)</span> are
sufficient for confounding control. For more information on what
constitutes a sufficient adjustment set, see <span class="citation">Witte and Didelez (2019)</span>. For a given summary
statistic <span class="math inline">\(T\)</span>, then <span class="math display">\[
T\{Y(X = x)\} = E_{\boldsymbol{Z}}[T\{Y | X = x, \boldsymbol{Z}\}],
\]</span> where the expectation is taken with respect to the population
distribution of <span class="math inline">\(\boldsymbol{Z}\)</span>.
This is also known as the <em>g-formula</em> or <em>adjustment
formula</em>.</p>
<p>In order to estimate this quantity based on an independent and
identically distributed sample <span class="math inline">\((X_1, Y_1,
\boldsymbol{Z}_1), \ldots, (X_n, Y_n, \boldsymbol{Z}_n)\)</span>, we
proceed by</p>
<ol style="list-style-type: decimal">
<li>Specifying and estimating a regression model for <span class="math inline">\(Y\)</span> given <span class="math inline">\(X\)</span> and <span class="math inline">\(\boldsymbol{Z}\)</span>.</li>
<li>Use the fitted model to obtain estimates of <span class="math inline">\(T\{Y_i | X_i = x, \boldsymbol{Z}_i\}\)</span> for
<span class="math inline">\(i = 1, \ldots, n\)</span>. This is done by
creating a copy of the observed dataset, replacing the observed <span class="math inline">\(X_i\)</span> with <span class="math inline">\(x\)</span> for each individual, and using the
fitted model to get predicted values for the copy of the observed data.
Denote these predicted values as <span class="math inline">\(\hat{T}\{Y_i | X_i = x,
\boldsymbol{Z}_i\}\)</span>.</li>
<li>Average over the empirical distribution of <span class="math inline">\(\boldsymbol{Z}\)</span> to obtain the estimate
<span class="math display">\[
\hat{T}\{Y(X = x)\} = \frac{1}{n}\sum_{i = 1}^n \hat{T}\{Y_i | X_i = x,
\boldsymbol{Z}_i\}.
\]</span>
</li>
</ol>
<p>One can do this for each level of <span class="math inline">\(X = 0,
1\)</span> and compute the desired contrast. Under the assumptions that
1) <span class="math inline">\(\boldsymbol{Z}\)</span> is sufficient for
confounding control, and 2) the regression model in step 1 is correctly
specified, then this estimator is consistent and asymptotically
normal.</p>
</div>
<div class="section level3">
<h3 id="improving-robustness-by-modeling-the-exposure">Improving robustness by modeling the exposure<a class="anchor" aria-label="anchor" href="#improving-robustness-by-modeling-the-exposure"></a>
</h3>
<p>A doubly-robust estimator is an estimator that is consistent for a
given estimand when one or more of the models used in the forming of the
estimator is correctly specified for confounding. So far, we only have
one model used in our estimator: the <em>outcome model</em>. We will now
introduce a model for the exposure, and see how we can combine them.
First, some terminology:</p>
<p><em>Misspecified model</em> - The true generating mechanism is not
contained in the possible mechanisms that are possible under the
selected model.</p>
<p><em>Correctly Specified</em> - A model is correctly specified if it
is not misspecified.</p>
<p><em>Correctly specified for confounding</em> - A correctly specified
model that contains a sufficient set of confounders.</p>
<p>If we can model <span class="math inline">\(P(X=1|\boldsymbol{Z})\)</span>, and it is
correctly specified and contains all confounders, then we can use that
to estimate the probability that each individual <span class="math inline">\(i\)</span> received the treatment that they did
<span class="math inline">\(W_i = \frac{X_i}{P(X_i=1|\boldsymbol{Z}_i)}
+ \frac{1-X_i}{1-P(X_i=1|\boldsymbol{Z}_i)}\)</span>. Let <span class="math inline">\(\hat{p}_i\)</span> denote the estimated
probability that subject <span class="math inline">\(i\)</span> received
treatment <span class="math inline">\(1\)</span>.</p>
<p>A Doubly robust estimator for the ATE is the Augmented inverse
probability weighted AIPW estimator: <span class="math display">\[
\frac{1}{n}\sum_{i = 1}^n\frac{Y_i X_i}{\hat{p}_i} - \frac{\hat{T}\{Y_i
| X_i = 1, \boldsymbol{Z}_i\}(X_i - \hat{p}_i)}{\hat{p}_i} - \frac{Y_i
(1 - X_i)}{1 - \hat{p}_i} - \frac{\hat{T}\{Y_i | X_i = 0,
\boldsymbol{Z}_i\}(X_i - \hat{p}_i)}{1 - \hat{p}_i}.  
\]</span> Any consistent estimation method can be used for the outcome
and exposure models. As long as either the outcome model or the
propensity score model is correctly specified for confounding, then this
doubly robust estimator is consistent for the ATE.</p>
<p>Recently, there seems to be a general misconception that combining an
adjusted outcome model and a propensity score model always gives a
doubly robust estimator. <strong>This is not true</strong> – it matters
how you combine them!</p>
</div>
<div class="section level2">
<h2 id="in-practice">In practice<a class="anchor" aria-label="anchor" href="#in-practice"></a>
</h2>
<p>Here we will use regression standardization to estimate the average
causal effect of the exposure (quitting smoking) in the variable
<code>qsmk</code> on the weight gain outcome in the variable
<code>wt82_71</code> in the <code>nhefs_complete</code> dataset that
comes with the <code>causaldata</code> package. The data was collected
as part of a project by the National Center for Health Statistics and
the National Institute on Aging in collaboration with other agencies of
the United States Public Health Service. It was designed to investigate
the relationships between clinical, nutritional, and behavioral factors
and subsequent morbidity, mortality, and hospital utilization and
changes in risk factors, functional limitation, and
institutionalization. The dataset includes 1566 individuals and contains
among others the following variables:</p>
<ul>
<li>seqn: person id}</li>
<li>wt82_71: weight gain in kilograms between 1971 and 1982</li>
<li>qsmk: quit smoking between between 1st questionnaire and 1982, 1 =
yes, 0 = no</li>
<li>sex: 0 = male, 1 = female</li>
<li>race: 0 = white, 1 = black or other</li>
<li>age: age in years at baseline</li>
<li>education: level of education in 1971, 1 = 8th grade or less, 2 =
high school dropout, 3 = high school, 4 - dropout, 5 = college or
more</li>
<li>smokeintensity: number of cigarettes smoked per day in 1971</li>
<li>smokeyrs: number of years smoked</li>
<li>exercise: level of physical activity in 1971, 0 = much exercise, 1 =
moderate exercise, 2 = little or no exercise</li>
<li>active: level of activity in 1971, 0 = very active, 1 = moderately
active, 2 = inactive, 3 = missing</li>
<li>wt71: weight in kilograms in 1971</li>
<li>ht: height in centimeters in 1971</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhefs_dat</span> <span class="op">&lt;-</span> <span class="fu">causaldata</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/causaldata/man/nhefs_complete.html" class="external-link">nhefs_complete</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nhefs_dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;       seqn            qsmk            death            yrdth      </span></span>
<span><span class="co">#&gt;  Min.   :  233   Min.   :0.0000   Min.   :0.0000   Min.   :83.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:10625   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:85.00  </span></span>
<span><span class="co">#&gt;  Median :20702   Median :0.0000   Median :0.0000   Median :88.00  </span></span>
<span><span class="co">#&gt;  Mean   :16639   Mean   :0.2573   Mean   :0.1858   Mean   :87.64  </span></span>
<span><span class="co">#&gt;  3rd Qu.:22771   3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:90.00  </span></span>
<span><span class="co">#&gt;  Max.   :25061   Max.   :1.0000   Max.   :1.0000   Max.   :92.00  </span></span>
<span><span class="co">#&gt;                                                    NA's   :1275   </span></span>
<span><span class="co">#&gt;      modth            dadth           sbp             dbp         sex    </span></span>
<span><span class="co">#&gt;  Min.   : 1.000   Min.   : 1.0   Min.   : 87.0   Min.   : 47.00   0:762  </span></span>
<span><span class="co">#&gt;  1st Qu.: 3.000   1st Qu.: 8.0   1st Qu.:115.0   1st Qu.: 70.00   1:804  </span></span>
<span><span class="co">#&gt;  Median : 6.000   Median :16.0   Median :126.0   Median : 77.00          </span></span>
<span><span class="co">#&gt;  Mean   : 6.383   Mean   :16.1   Mean   :128.6   Mean   : 77.74          </span></span>
<span><span class="co">#&gt;  3rd Qu.:10.000   3rd Qu.:24.5   3rd Qu.:139.0   3rd Qu.: 85.00          </span></span>
<span><span class="co">#&gt;  Max.   :12.000   Max.   :31.0   Max.   :229.0   Max.   :130.00          </span></span>
<span><span class="co">#&gt;  NA's   :1271     NA's   :1271   NA's   :29      NA's   :33              </span></span>
<span><span class="co">#&gt;       age        race         income         marital          school     </span></span>
<span><span class="co">#&gt;  Min.   :25.00   0:1360   Min.   :11.00   Min.   :2.000   Min.   : 0.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:33.00   1: 206   1st Qu.:17.00   1st Qu.:2.000   1st Qu.:10.00  </span></span>
<span><span class="co">#&gt;  Median :43.00            Median :19.00   Median :2.000   Median :12.00  </span></span>
<span><span class="co">#&gt;  Mean   :43.66            Mean   :17.99   Mean   :2.496   Mean   :11.17  </span></span>
<span><span class="co">#&gt;  3rd Qu.:53.00            3rd Qu.:20.00   3rd Qu.:2.000   3rd Qu.:12.00  </span></span>
<span><span class="co">#&gt;  Max.   :74.00            Max.   :22.00   Max.   :8.000   Max.   :17.00  </span></span>
<span><span class="co">#&gt;                           NA's   :59                                     </span></span>
<span><span class="co">#&gt;  education       ht             wt71             wt82           wt82_71       </span></span>
<span><span class="co">#&gt;  1:291     Min.   :142.9   Min.   : 39.58   Min.   : 35.38   Min.   :-41.280  </span></span>
<span><span class="co">#&gt;  2:340     1st Qu.:161.8   1st Qu.: 59.53   1st Qu.: 61.69   1st Qu.: -1.478  </span></span>
<span><span class="co">#&gt;  3:637     Median :168.2   Median : 69.23   Median : 72.12   Median :  2.604  </span></span>
<span><span class="co">#&gt;  4:121     Mean   :168.7   Mean   : 70.83   Mean   : 73.47   Mean   :  2.638  </span></span>
<span><span class="co">#&gt;  5:177     3rd Qu.:175.3   3rd Qu.: 79.80   3rd Qu.: 83.46   3rd Qu.:  6.690  </span></span>
<span><span class="co">#&gt;            Max.   :198.1   Max.   :151.73   Max.   :136.53   Max.   : 48.538  </span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;    birthplace    smokeintensity  smkintensity82_71    smokeyrs    </span></span>
<span><span class="co">#&gt;  Min.   : 1.00   Min.   : 1.00   Min.   :-80.000   Min.   : 1.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:22.00   1st Qu.:10.00   1st Qu.:-10.000   1st Qu.:15.00  </span></span>
<span><span class="co">#&gt;  Median :34.00   Median :20.00   Median : -1.000   Median :24.00  </span></span>
<span><span class="co">#&gt;  Mean   :31.67   Mean   :20.53   Mean   : -4.633   Mean   :24.59  </span></span>
<span><span class="co">#&gt;  3rd Qu.:42.00   3rd Qu.:30.00   3rd Qu.:  1.000   3rd Qu.:33.00  </span></span>
<span><span class="co">#&gt;  Max.   :56.00   Max.   :80.00   Max.   : 50.000   Max.   :64.00  </span></span>
<span><span class="co">#&gt;  NA's   :90                                                       </span></span>
<span><span class="co">#&gt;      asthma            bronch              tb                hf          </span></span>
<span><span class="co">#&gt;  Min.   :0.00000   Min.   :0.00000   Min.   :0.00000   Min.   :0.000000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.000000  </span></span>
<span><span class="co">#&gt;  Median :0.00000   Median :0.00000   Median :0.00000   Median :0.000000  </span></span>
<span><span class="co">#&gt;  Mean   :0.04853   Mean   :0.08365   Mean   :0.01341   Mean   :0.005109  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.000000  </span></span>
<span><span class="co">#&gt;  Max.   :1.00000   Max.   :1.00000   Max.   :1.00000   Max.   :1.000000  </span></span>
<span><span class="co">#&gt;                                                                          </span></span>
<span><span class="co">#&gt;       hbp         pepticulcer        colitis          hepatitis      </span></span>
<span><span class="co">#&gt;  Min.   :0.000   Min.   :0.0000   Min.   :0.00000   Min.   :0.00000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Median :1.000   Median :0.0000   Median :0.00000   Median :0.00000  </span></span>
<span><span class="co">#&gt;  Mean   :1.059   Mean   :0.1015   Mean   :0.03448   Mean   :0.01788  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2.000   3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Max.   :2.000   Max.   :1.0000   Max.   :1.00000   Max.   :1.00000  </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;   chroniccough        hayfever          diabetes          polio        </span></span>
<span><span class="co">#&gt;  Min.   :0.00000   Min.   :0.00000   Min.   :0.0000   Min.   :0.00000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Median :0.00000   Median :0.00000   Median :0.0000   Median :0.00000  </span></span>
<span><span class="co">#&gt;  Mean   :0.05109   Mean   :0.08621   Mean   :0.9898   Mean   :0.01405  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:2.0000   3rd Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Max.   :1.00000   Max.   :1.00000   Max.   :2.0000   Max.   :1.00000  </span></span>
<span><span class="co">#&gt;                                                                        </span></span>
<span><span class="co">#&gt;      tumor          nervousbreak       alcoholpy       alcoholfreq   </span></span>
<span><span class="co">#&gt;  Min.   :0.00000   Min.   :0.00000   Min.   :0.0000   Min.   :0.000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:1.0000   1st Qu.:1.000  </span></span>
<span><span class="co">#&gt;  Median :0.00000   Median :0.00000   Median :1.0000   Median :2.000  </span></span>
<span><span class="co">#&gt;  Mean   :0.02363   Mean   :0.02746   Mean   :0.8787   Mean   :1.913  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:1.0000   3rd Qu.:3.000  </span></span>
<span><span class="co">#&gt;  Max.   :1.00000   Max.   :1.00000   Max.   :2.0000   Max.   :5.000  </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;   alcoholtype    alcoholhowmuch        pica          headache     </span></span>
<span><span class="co">#&gt;  Min.   :1.000   Min.   : 1.000   Min.   :0.000   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:1.000   1st Qu.: 2.000   1st Qu.:0.000   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median :3.000   Median : 2.000   Median :0.000   Median :1.0000  </span></span>
<span><span class="co">#&gt;  Mean   :2.466   Mean   : 3.293   Mean   :0.986   Mean   :0.6328  </span></span>
<span><span class="co">#&gt;  3rd Qu.:4.000   3rd Qu.: 4.000   3rd Qu.:2.000   3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :4.000   Max.   :48.000   Max.   :2.000   Max.   :1.0000  </span></span>
<span><span class="co">#&gt;                  NA's   :397                                      </span></span>
<span><span class="co">#&gt;    otherpain        weakheart         allergies           nerves     </span></span>
<span><span class="co">#&gt;  Min.   :0.0000   Min.   :0.00000   Min.   :0.00000   Min.   :0.000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.000  </span></span>
<span><span class="co">#&gt;  Median :0.0000   Median :0.00000   Median :0.00000   Median :0.000  </span></span>
<span><span class="co">#&gt;  Mean   :0.2433   Mean   :0.02235   Mean   :0.06322   Mean   :0.145  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.000  </span></span>
<span><span class="co">#&gt;  Max.   :1.0000   Max.   :1.00000   Max.   :1.00000   Max.   :1.000  </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;     lackpep            hbpmed       boweltrouble       wtloss       </span></span>
<span><span class="co">#&gt;  Min.   :0.00000   Min.   :0.000   Min.   :0.000   Min.   :0.00000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.000   1st Qu.:0.000   1st Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Median :0.00000   Median :1.000   Median :1.000   Median :0.00000  </span></span>
<span><span class="co">#&gt;  Mean   :0.05045   Mean   :1.015   Mean   :1.046   Mean   :0.02618  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:0.00000  </span></span>
<span><span class="co">#&gt;  Max.   :1.00000   Max.   :2.000   Max.   :2.000   Max.   :1.00000  </span></span>
<span><span class="co">#&gt;                                                                     </span></span>
<span><span class="co">#&gt;    infection     active  exercise  birthcontrol    pregnancies    </span></span>
<span><span class="co">#&gt;  Min.   :0.000   0:702   0:300    Min.   :0.000   Min.   : 1.000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.000   1:715   1:661    1st Qu.:0.000   1st Qu.: 2.000  </span></span>
<span><span class="co">#&gt;  Median :0.000   2:149   2:605    Median :1.000   Median : 3.000  </span></span>
<span><span class="co">#&gt;  Mean   :0.145                    Mean   :1.081   Mean   : 3.694  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.000                    3rd Qu.:2.000   3rd Qu.: 5.000  </span></span>
<span><span class="co">#&gt;  Max.   :1.000                    Max.   :2.000   Max.   :15.000  </span></span>
<span><span class="co">#&gt;                                                   NA's   :866     </span></span>
<span><span class="co">#&gt;   cholesterol      hightax82         price71         price82     </span></span>
<span><span class="co">#&gt;  Min.   : 78.0   Min.   :0.0000   Min.   :1.507   Min.   :1.452  </span></span>
<span><span class="co">#&gt;  1st Qu.:189.0   1st Qu.:0.0000   1st Qu.:2.037   1st Qu.:1.740  </span></span>
<span><span class="co">#&gt;  Median :216.0   Median :0.0000   Median :2.168   Median :1.815  </span></span>
<span><span class="co">#&gt;  Mean   :219.9   Mean   :0.1653   Mean   :2.138   Mean   :1.806  </span></span>
<span><span class="co">#&gt;  3rd Qu.:245.0   3rd Qu.:0.0000   3rd Qu.:2.242   3rd Qu.:1.868  </span></span>
<span><span class="co">#&gt;  Max.   :416.0   Max.   :1.0000   Max.   :2.693   Max.   :2.103  </span></span>
<span><span class="co">#&gt;  NA's   :16      NA's   :90       NA's   :90      NA's   :90     </span></span>
<span><span class="co">#&gt;      tax71            tax82          price71_82         tax71_82     </span></span>
<span><span class="co">#&gt;  Min.   :0.5249   Min.   :0.2200   Min.   :-0.2027   Min.   :0.0360  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.9449   1st Qu.:0.4399   1st Qu.: 0.2010   1st Qu.:0.4610  </span></span>
<span><span class="co">#&gt;  Median :1.0498   Median :0.5060   Median : 0.3360   Median :0.5440  </span></span>
<span><span class="co">#&gt;  Mean   :1.0580   Mean   :0.5058   Mean   : 0.3324   Mean   :0.5522  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.1548   3rd Qu.:0.5719   3rd Qu.: 0.4438   3rd Qu.:0.6220  </span></span>
<span><span class="co">#&gt;  Max.   :1.5225   Max.   :0.7479   Max.   : 0.6121   Max.   :0.8844  </span></span>
<span><span class="co">#&gt;  NA's   :90       NA's   :90       NA's   :90        NA's   :90      </span></span>
<span><span class="co">#&gt;        id            censored     older       </span></span>
<span><span class="co">#&gt;  Min.   :   1.0   Min.   :0   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.: 414.2   1st Qu.:0   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median : 824.5   Median :0   Median :0.0000  </span></span>
<span><span class="co">#&gt;  Mean   : 821.0   Mean   :0   Mean   :0.2989  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1228.8   3rd Qu.:0   3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :1629.0   Max.   :0   Max.   :1.0000  </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>We will assume that the set of confounders in <span class="math inline">\(\boldsymbol{Z}\)</span> includes sex, race, age,
education, number of cigarettes smoked per year, the number of years
smoked, level of physical activity, and baseline weight in 1971. This
equivalent to assuming that the counterfactual weight gain is
independent of the exposure conditional on these variables. In other
words, we are assuming the following directed acyclic graph:</p>
<p><img src="overview_files/figure-html/unnamed-chunk-3-1.png" width="30%"></p>
<p>For the specific forms of the conditional expectations required in
the outcome we assume a linear regression model with both linear and
quadratic forms of the continuous covariates. We can fit this as</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">wt82_71</span> <span class="op">~</span> <span class="va">qsmk</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>        data <span class="op">=</span> <span class="va">nhefs_dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age^2) + </span></span>
<span><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity^2) + </span></span>
<span><span class="co">#&gt;     smokeyrs + I(smokeyrs^2) + as.factor(exercise) + as.factor(active) + </span></span>
<span><span class="co">#&gt;     wt71 + I(wt71^2), data = nhefs_dat)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                         Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)           -1.6586176  4.3137734  -0.384 0.700666    </span></span>
<span><span class="co">#&gt; qsmk                   3.4626218  0.4384543   7.897 5.36e-15 ***</span></span>
<span><span class="co">#&gt; sex1                  -1.4650496  0.4683410  -3.128 0.001792 ** </span></span>
<span><span class="co">#&gt; race1                  0.5864117  0.5816949   1.008 0.313560    </span></span>
<span><span class="co">#&gt; age                    0.3626624  0.1633431   2.220 0.026546 *  </span></span>
<span><span class="co">#&gt; I(age^2)              -0.0061377  0.0017263  -3.555 0.000389 ***</span></span>
<span><span class="co">#&gt; as.factor(education)2  0.8185263  0.6067815   1.349 0.177546    </span></span>
<span><span class="co">#&gt; as.factor(education)3  0.5715004  0.5561211   1.028 0.304273    </span></span>
<span><span class="co">#&gt; as.factor(education)4  1.5085173  0.8323778   1.812 0.070134 .  </span></span>
<span><span class="co">#&gt; as.factor(education)5 -0.1708264  0.7413289  -0.230 0.817786    </span></span>
<span><span class="co">#&gt; smokeintensity         0.0651533  0.0503115   1.295 0.195514    </span></span>
<span><span class="co">#&gt; I(smokeintensity^2)   -0.0010468  0.0009373  -1.117 0.264261    </span></span>
<span><span class="co">#&gt; smokeyrs               0.1333931  0.0917319   1.454 0.146104    </span></span>
<span><span class="co">#&gt; I(smokeyrs^2)         -0.0018270  0.0015438  -1.183 0.236818    </span></span>
<span><span class="co">#&gt; as.factor(exercise)1   0.3206824  0.5349616   0.599 0.548961    </span></span>
<span><span class="co">#&gt; as.factor(exercise)2   0.3628786  0.5589557   0.649 0.516300    </span></span>
<span><span class="co">#&gt; as.factor(active)1    -0.9429574  0.4100208  -2.300 0.021593 *  </span></span>
<span><span class="co">#&gt; as.factor(active)2    -0.2580374  0.6847219  -0.377 0.706337    </span></span>
<span><span class="co">#&gt; wt71                   0.0373642  0.0831658   0.449 0.653297    </span></span>
<span><span class="co">#&gt; I(wt71^2)             -0.0009158  0.0005235  -1.749 0.080426 .  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 53.59474)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 82857  on 1546  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 10701</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>To perform regression standardization to estimate the causal effect
we use <code>standardize_glm</code>. We must specify the same outcome
regression model as a formula, provide the data, describe which values
of the exposure we wish to estimate the counterfactual means, specify
which contrasts we want, and specify the reference level for the
contrasts. The following command estimates that model and we obtain the
group-wise estimates, the difference, and the ratio.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_glm.html">standardize_glm</a></span><span class="op">(</span><span class="va">wt82_71</span> <span class="op">~</span> <span class="va">qsmk</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">nhefs_dat</span>, </span>
<span>            values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>qsmk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"difference"</span>, <span class="st">"ratio"</span><span class="op">)</span>,</span>
<span>            reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m2</span></span>
<span><span class="co">#&gt; Outcome formula: wt82_71 ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Outcome family: gaussian </span></span>
<span><span class="co">#&gt; Outcome link function: identity </span></span>
<span><span class="co">#&gt; Exposure:  qsmk </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tables: </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.75     0.217       1.32       2.17</span></span>
<span><span class="co">#&gt; 2    1     5.21     0.420       4.39       6.03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  difference </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     0.00     0.000       0.00       0.00</span></span>
<span><span class="co">#&gt; 2    1     3.46     0.466       2.55       4.38</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  ratio </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.00     0.000       1.00       1.00</span></span>
<span><span class="co">#&gt; 2    1     2.98     0.435       2.13       3.83</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<p><img src="overview_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m2</span>, contrast <span class="op">=</span> <span class="st">"difference"</span>, reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="overview_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<p>The output from the model shows the estimated potential outcome means
in each exposure level, the difference and ratio thereof, and the
associated standard error estimates, confidence intervals, and p-values.
Inference is done using the sandwich method for variance calculation.
Under the assumptions that the outcome model is correctly specified and
contains all confounders, these are consistent estimates of the causal
effects of interest. We can also get plots of the effects by using the
plot function.</p>
<p>To obtain the estimates and inference for the different contrasts as
a tidy data frame, suitable for saving as a data table or using in
downstream analyses or reports, we provide the <code>tidy</code>
function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">tidy_m2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95   contrast transform</span></span>
<span><span class="co">#&gt; 1    0 1.747216 0.2174047   1.321111   2.173322       none  identity</span></span>
<span><span class="co">#&gt; 2    1 5.209838 0.4199393   4.386772   6.032904       none  identity</span></span>
<span><span class="co">#&gt; 3    0 0.000000 0.0000000   0.000000   0.000000 difference  identity</span></span>
<span><span class="co">#&gt; 4    1 3.462622 0.4660848   2.549112   4.376131 difference  identity</span></span>
<span><span class="co">#&gt; 5    0 1.000000 0.0000000   1.000000   1.000000      ratio  identity</span></span>
<span><span class="co">#&gt; 6    1 2.981793 0.4349643   2.129279   3.834308      ratio  identity</span></span></code></pre></div>
<p>To obtain doubly robust inference we use the following command. Note
that we now specify a model for the exposure, the propensity score
model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2_dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_glm_dr.html">standardize_glm_dr</a></span><span class="op">(</span>formula_outcome <span class="op">=</span> <span class="va">wt82_71</span> <span class="op">~</span> <span class="va">qsmk</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>               formula_exposure <span class="op">=</span> <span class="va">qsmk</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">nhefs_dat</span>, </span>
<span>            values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>qsmk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            contrast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"difference"</span>, <span class="st">"ratio"</span><span class="op">)</span>,</span>
<span>            reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">m2_dr</span></span>
<span><span class="co">#&gt; Doubly robust estimator with: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Exposure formula: qsmk ~ sex + race + age + I(age^2) + as.factor(education) + smokeintensity + </span></span>
<span><span class="co">#&gt;     I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + as.factor(exercise) + </span></span>
<span><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Exposure link function: logit </span></span>
<span><span class="co">#&gt; Outcome formula: wt82_71 ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Outcome family: gaussian </span></span>
<span><span class="co">#&gt; Outcome link function: identity </span></span>
<span><span class="co">#&gt; Exposure:  qsmk </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tables: </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.76     0.218       1.34       2.19</span></span>
<span><span class="co">#&gt; 2    1     5.19     0.438       4.33       6.04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  difference </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     0.00      0.00       0.00       0.00</span></span>
<span><span class="co">#&gt; 2    1     3.42      0.48       2.48       4.37</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  ratio </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.00     0.000        1.0       1.00</span></span>
<span><span class="co">#&gt; 2    1     2.94     0.431        2.1       3.79</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">m2_dr</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">tidy_m2_dr</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95   contrast transform</span></span>
<span><span class="co">#&gt; 1    0 1.762981 0.2176810   1.336334   2.189628       none  identity</span></span>
<span><span class="co">#&gt; 2    1 5.186772 0.4378466   4.328609   6.044936       none  identity</span></span>
<span><span class="co">#&gt; 3    0 0.000000 0.0000000   0.000000   0.000000 difference  identity</span></span>
<span><span class="co">#&gt; 4    1 3.423792 0.4804026   2.482220   4.365363 difference  identity</span></span>
<span><span class="co">#&gt; 5    0 1.000000 0.0000000   1.000000   1.000000      ratio  identity</span></span>
<span><span class="co">#&gt; 6    1 2.942047 0.4310190   2.097265   3.786829      ratio  identity</span></span></code></pre></div>
<p>Based on these results, we can report that the estimated effect of
smoking on average weight change as measured by the difference in
potential outcome means is 3.46 (2.55 to 4.38) and as measured by the
ratio of potential outcome means is 2.98 (2.13 to 3.83). Using the
doubly-robust estimation method, we obtain similarly 3.42 (2.48 to 4.37)
and as measured by the ratio of potential outcome means is 2.94 (2.10 to
3.79). In particular, if we believe that the necessary assumptions are
valid, we can conclude that smoking causes an increase in weight which
the numeric summaries indicate that smoking increases the weight change
over 11 years by about 3.5 pounds (additive scale) or smoking increases
the weight change over 11 years by a multiplicative factor of about
3.</p>
<p>The doubly-robust method requires specification of an exposure model
in addition to the specification of the outcome model. Both of these
estimated models can be accessed and inspected by looking at the
<code>fit_outcome</code> and <code>fit_exposure</code> elements of the
return object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2_dr</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">fit_outcome</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:  glm(formula = formula, family = family, data = data, weights = weights)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;           (Intercept)                   qsmk                   sex1  </span></span>
<span><span class="co">#&gt;            -1.931e+00              3.424e+00             -1.989e+00  </span></span>
<span><span class="co">#&gt;                 race1                    age               I(age^2)  </span></span>
<span><span class="co">#&gt;             4.707e-01              6.207e-01             -8.678e-03  </span></span>
<span><span class="co">#&gt; as.factor(education)2  as.factor(education)3  as.factor(education)4  </span></span>
<span><span class="co">#&gt;             1.935e+00              8.366e-01              2.564e+00  </span></span>
<span><span class="co">#&gt; as.factor(education)5         smokeintensity    I(smokeintensity^2)  </span></span>
<span><span class="co">#&gt;             8.339e-01              1.130e-01             -2.240e-03  </span></span>
<span><span class="co">#&gt;              smokeyrs          I(smokeyrs^2)   as.factor(exercise)1  </span></span>
<span><span class="co">#&gt;             1.034e-01             -1.473e-03              7.865e-01  </span></span>
<span><span class="co">#&gt;  as.factor(exercise)2     as.factor(active)1     as.factor(active)2  </span></span>
<span><span class="co">#&gt;             1.231e+00             -8.251e-01             -4.576e-01  </span></span>
<span><span class="co">#&gt;                  wt71              I(wt71^2)  </span></span>
<span><span class="co">#&gt;            -1.221e-01              8.616e-06  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Degrees of Freedom: 1565 Total (i.e. Null);  1546 Residual</span></span>
<span><span class="co">#&gt; Null Deviance:       212700 </span></span>
<span><span class="co">#&gt; Residual Deviance: 175100    AIC: 11030</span></span>
<span><span class="va">m2_dr</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">fit_exposure</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:  glm(formula = formula, family = family, data = data, weights = weights)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;           (Intercept)                   sex1                  race1  </span></span>
<span><span class="co">#&gt;            -2.2425191             -0.5274782             -0.8392636  </span></span>
<span><span class="co">#&gt;                   age               I(age^2)  as.factor(education)2  </span></span>
<span><span class="co">#&gt;             0.1212052             -0.0008246             -0.0287755  </span></span>
<span><span class="co">#&gt; as.factor(education)3  as.factor(education)4  as.factor(education)5  </span></span>
<span><span class="co">#&gt;             0.0864318              0.0636010              0.4759606  </span></span>
<span><span class="co">#&gt;        smokeintensity    I(smokeintensity^2)               smokeyrs  </span></span>
<span><span class="co">#&gt;            -0.0772704              0.0010451             -0.0735966  </span></span>
<span><span class="co">#&gt;         I(smokeyrs^2)   as.factor(exercise)1   as.factor(exercise)2  </span></span>
<span><span class="co">#&gt;             0.0008441              0.3548405              0.3957040  </span></span>
<span><span class="co">#&gt;    as.factor(active)1     as.factor(active)2                   wt71  </span></span>
<span><span class="co">#&gt;             0.0319445              0.1767840             -0.0152357  </span></span>
<span><span class="co">#&gt;             I(wt71^2)  </span></span>
<span><span class="co">#&gt;             0.0001352  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Degrees of Freedom: 1565 Total (i.e. Null);  1547 Residual</span></span>
<span><span class="co">#&gt; Null Deviance:       1786 </span></span>
<span><span class="co">#&gt; Residual Deviance: 1677  AIC: 1715</span></span></code></pre></div>
<p>This is useful when we want to inspect the distribution of the
propensity scores by exposure status. This is an important thing to
check in practice, we are looking for any practical violations of the
positivity assumption.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">m2_dr</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">fit_exposure</span><span class="op">$</span><span class="va">fitted</span><span class="op">[</span><span class="va">nhefs_dat</span><span class="op">$</span><span class="va">qsmk</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, </span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"qsmk = 0"</span>, xlab <span class="op">=</span> <span class="st">"estimated propensity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="overview_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">m2_dr</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">fit_exposure</span><span class="op">$</span><span class="va">fitted</span><span class="op">[</span><span class="va">nhefs_dat</span><span class="op">$</span><span class="va">qsmk</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, </span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"qsmk = 1"</span>, xlab <span class="op">=</span> <span class="st">"estimated propensity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="overview_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<div class="section level3">
<h3 id="other-outcome-types">Other outcome types<a class="anchor" aria-label="anchor" href="#other-outcome-types"></a>
</h3>
<p>The function <code>standardize_glm</code> and its doubly-robust
counterpart <code>standardize_glm_dr</code> support any outcome variable
type the can be used with <code>glm</code>. This includes binary, count,
and more. Just like in <code>glm</code>, we specify the model we would
like to use for the outcome by specifying the <code>family</code>
argument of <code>standardize_glm</code> or the
<code>family_outcome</code> argument of <code>standardize_glm_dr</code>.
By default this is <code>"gaussian"</code> which corresponds to linear
regression. For a binary outcome we might like to use
<code>"binomial"</code> which corresponds to logistic regression. Let us
see how it works using the a binary outcome that we create by
dichotomizing the weight change at 0.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhefs_dat</span><span class="op">$</span><span class="va">gained_weight</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">*</span> <span class="op">(</span><span class="va">nhefs_dat</span><span class="op">$</span><span class="va">wt82_71</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_glm.html">standardize_glm</a></span><span class="op">(</span><span class="va">gained_weight</span> <span class="op">~</span> <span class="va">qsmk</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">nhefs_dat</span>, </span>
<span>            family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>qsmk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"difference"</span>, <span class="st">"ratio"</span><span class="op">)</span>,</span>
<span>            reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m3</span></span>
<span><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span><span class="co">#&gt; Outcome link function: logit </span></span>
<span><span class="co">#&gt; Exposure:  qsmk </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tables: </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0    0.639    0.0140      0.611      0.666</span></span>
<span><span class="co">#&gt; 2    1    0.772    0.0195      0.733      0.810</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  difference </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0    0.000    0.0000     0.0000      0.000</span></span>
<span><span class="co">#&gt; 2    1    0.133    0.0236     0.0866      0.179</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  ratio </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.00    0.0000       1.00       1.00</span></span>
<span><span class="co">#&gt; 2    1     1.21    0.0398       1.13       1.29</span></span></code></pre></div>
<p>Here we interpret the estimates in terms of probabilities, or the
risk of gaining weight over 11 years. In particular, smoking causes a
13% additive increase in the risk of gaining weight, or a 1.2 fold
multiplicative increase in the risk of gaining weight. With binary
outcomes, we can use tranforms to get different contrasts, and also to
improve the performance of the ratio contrast. By using the log
transformation combined with the difference contrast, our estimates
become the log risk ratios. We can exponential them to get the risk
ratios, but often it is better to construct confidence intervals of
ratios on the log scale and back transform.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_glm.html">standardize_glm</a></span><span class="op">(</span><span class="va">gained_weight</span> <span class="op">~</span> <span class="va">qsmk</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">nhefs_dat</span>, </span>
<span>            family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>qsmk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"difference"</span><span class="op">)</span>,</span>
<span>            transforms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>            reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">m3_log</span></span>
<span><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span><span class="co">#&gt; Outcome link function: logit </span></span>
<span><span class="co">#&gt; Exposure:  qsmk </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tables: </span></span>
<span><span class="co">#&gt; Transform:  </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0   -0.448    0.0220     -0.492     -0.405</span></span>
<span><span class="co">#&gt; 2    1   -0.259    0.0253     -0.309     -0.210</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transform:  </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  difference </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0    0.000    0.0000      0.000      0.000</span></span>
<span><span class="co">#&gt; 2    1    0.189    0.0329      0.125      0.254</span></span></code></pre></div>
<p>The estimates reported in the table are log risk ratios, which we now
back transform by exponentiating and compare to the ratios estimated
previously.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm3_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">m3_log</span><span class="op">)</span></span>
<span><span class="va">tm3_log</span><span class="op">$</span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tm3_log</span><span class="op">$</span><span class="va">Estimate</span><span class="op">)</span></span>
<span><span class="va">tm3_log</span><span class="op">$</span><span class="va">rr.lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tm3_log</span><span class="op">$</span><span class="va">lower.0.95</span><span class="op">)</span></span>
<span><span class="va">tm3_log</span><span class="op">$</span><span class="va">rr.upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">tm3_log</span><span class="op">$</span><span class="va">upper.0.95</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tm3_log</span>, <span class="va">contrast</span> <span class="op">==</span> <span class="st">"difference"</span> <span class="op">&amp;</span> <span class="va">qsmk</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   qsmk  Estimate  Std.Error lower.0.95 upper.0.95   contrast transform       rr</span></span>
<span><span class="co">#&gt; 4    1 0.1890909 0.03292713  0.1245549  0.2536269 difference       log 1.208151</span></span>
<span><span class="co">#&gt;   rr.lower rr.upper</span></span>
<span><span class="co">#&gt; 4 1.132644 1.288691</span></span>
<span><span class="va">m3</span></span>
<span><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span><span class="co">#&gt; Outcome link function: logit </span></span>
<span><span class="co">#&gt; Exposure:  qsmk </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tables: </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0    0.639    0.0140      0.611      0.666</span></span>
<span><span class="co">#&gt; 2    1    0.772    0.0195      0.733      0.810</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  difference </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0    0.000    0.0000     0.0000      0.000</span></span>
<span><span class="co">#&gt; 2    1    0.133    0.0236     0.0866      0.179</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  ratio </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.00    0.0000       1.00       1.00</span></span>
<span><span class="co">#&gt; 2    1     1.21    0.0398       1.13       1.29</span></span></code></pre></div>
<p>In this case, the estimates and inference using transformation are
nearly identical to those without transformation.</p>
<p>Other available transformations include the odds, and logit (log
odds). These can be used to estimate causal odds ratios, untransformed
and transformed, respectively.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3_odds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_glm.html">standardize_glm</a></span><span class="op">(</span><span class="va">gained_weight</span> <span class="op">~</span> <span class="va">qsmk</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">nhefs_dat</span>, </span>
<span>            family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>qsmk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ratio"</span><span class="op">)</span>,</span>
<span>            transforms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"odds"</span><span class="op">)</span>,</span>
<span>            reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">m3_odds</span></span>
<span><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span><span class="co">#&gt; Outcome link function: logit </span></span>
<span><span class="co">#&gt; Exposure:  qsmk </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tables: </span></span>
<span><span class="co">#&gt; Transform:  </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.77     0.108       1.56       1.98</span></span>
<span><span class="co">#&gt; 2    1     3.38     0.374       2.64       4.11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transform:  </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  ratio </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0     1.00     0.000       1.00       1.00</span></span>
<span><span class="co">#&gt; 2    1     1.91     0.238       1.44       2.38</span></span>
<span></span>
<span><span class="va">m3_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_glm.html">standardize_glm</a></span><span class="op">(</span><span class="va">gained_weight</span> <span class="op">~</span> <span class="va">qsmk</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">education</span><span class="op">)</span> <span class="op">+</span> <span class="va">smokeintensity</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeintensity</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="va">smokeyrs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">smokeyrs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">exercise</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="va">wt71</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">wt71</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">nhefs_dat</span>, </span>
<span>            family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>qsmk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"difference"</span><span class="op">)</span>,</span>
<span>            transforms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            reference <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">m3_logit</span></span>
<span><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span><span class="co">#&gt; Outcome link function: logit </span></span>
<span><span class="co">#&gt; Exposure:  qsmk </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tables: </span></span>
<span><span class="co">#&gt; Transform:  </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0    0.569    0.0609       0.45      0.689</span></span>
<span><span class="co">#&gt; 2    1    1.217    0.1108       1.00      1.434</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transform:  </span></span>
<span><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span><span class="co">#&gt; Contrast:  difference </span></span>
<span><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span><span class="co">#&gt; 1    0    0.000     0.000      0.000      0.000</span></span>
<span><span class="co">#&gt; 2    1    0.648     0.124      0.404      0.892</span></span>
<span></span>
<span><span class="va">m3_logOR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">m3_logit</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">contrast</span> <span class="op">==</span> <span class="st">"difference"</span> <span class="op">&amp;</span> <span class="va">qsmk</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f (%.2f to %.2f)"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m3_logOR</span><span class="op">$</span><span class="va">Estimate</span><span class="op">)</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m3_logOR</span><span class="op">$</span><span class="va">lower.0.95</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m3_logOR</span><span class="op">$</span><span class="va">upper.0.95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1.91 (1.50 to 2.44)"</span></span></code></pre></div>
<p>In this case the estimate is identical, but the confidence interval
is slightly different because it is symmetric on the odds ratio scale in
the first case, and symmetric on the log odds ratio scale in the
transformed case.</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-sjolander2016regression" class="csl-entry">
Sjölander, Arvid. 2016. <span>“Regression Standardization with the r
Package stdReg.”</span> <em>European Journal of Epidemiology</em> 31:
563–74.
</div>
<div id="ref-sjolander2018estimation" class="csl-entry">
———. 2018. <span>“Estimation of Causal Effect Measures with the
r-Package stdReg.”</span> <em>European Journal of Epidemiology</em> 33:
847–58.
</div>
<div id="ref-witte2019covariate" class="csl-entry">
Witte, Janine, and Vanessa Didelez. 2019. <span>“Covariate Selection
Strategies for Causal Inference: Classification and Comparison.”</span>
<em>Biometrical Journal</em> 61 (5): 1270–89.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael C Sachs, Arvid Sjölander, Erin E Gabriel, Johan Sebastian Ohlendorff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
